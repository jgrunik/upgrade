<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://unpkg.com/htmx.org@1.9.5"></script>
    <script src="https://unpkg.com/hyperscript.org@0.9.11"></script>
    <script src="https://unpkg.com/peerjs@1.5.1/dist/peerjs.min.js"></script>
    <script>
      var peer = new Peer();
      peer.on("open", function (id) {
        console.log("My peer ID is: " + id);
      });

      function createRoom() {
        peer.on("connection", function (conn) {
          console.log("I've been connected to!");
          conn.on("data", function (data) {
            console.log("Received", data);
          });

          conn.send("8==D");
        });
        document.getElementById("room_code").value = peer.id;
      }

      function joinRoom() {
        const host_id = document.getElementById("room_code").value;
        const host_conn = peer.connect(host_id);
        host_conn.on("open", function () {
          host_conn.on("data", function (data) {
            console.log("Received", data);
          });

          host_conn.send("Hello!");
        });
      }
    </script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css"
    />
    <title>Upgrade</title>
  </head>

  <body>
    <header class="container">
      <hgroup>
        <h1>Upgrade</h1>
        <h2>by Joshua Grunik</h2>
      </hgroup>
    </header>

    <main htmx-boost="true" class="container">
      <button _="on click toggle @disabled then call createRoom()">
        Create Room
      </button>
      <input
        id="room_code"
        name="room_code"
        type="text"
        aria-label="Room Code"
        placeholder="Room Code"
      />
      <button _="on click toggle @disabled then call joinRoom()">
        Join Room
      </button>
    </main>
  </body>
</html>
