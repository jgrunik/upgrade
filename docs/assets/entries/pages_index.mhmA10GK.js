import{o as D,a as q,c as u,u as X,b as K,d as w,e as y,f as C,g as i,s as v,m as E,h as p,j as U,k as V,S as W,r as g,t as m,l as G,n as f,p as S,q as z,v as Z,w as ee,x as oe,y as te,i as ne}from"../chunks/chunk-k5oiU1Xp.js";import{_ as re}from"../chunks/chunk-GgBbLaes.js";function x(o,e={}){const t=K(o);function n(a){var s;let c=(s=e.onInit)==null?void 0:s.call(e,a);return D(()=>{var l;c=(l=e.onMount)==null?void 0:l.call(e,c)}),q(()=>{var l;return(l=e.onCleanUp)==null?void 0:l.call(e,c)}),u(t.Provider,{value:o,get children(){return a.children}})}function r(){const a=X(t);if(a===void 0)throw new Error("use() must be used within a Context.Provider");return a}return{Provider:n,use:r}}function N(...o){o==null||o.forEach(([e,t])=>se(e,t))}function se(o,e){w(y(e,()=>localStorage.setItem(o,e()),{defer:!0}))}const[P,H]=C(),{Provider:ae,use:M}=x({localPlayer:P,setLocalPlayer:H},{onInit(){N(["playerId",()=>P.id],["nickname",()=>P.nickname],["avatarSeed",()=>P.avatarSeed])},onMount(){H({id:localStorage.getItem("playerId")??window.crypto.randomUUID(),nickname:localStorage.getItem("nickname")??"",avatarSeed:localStorage.getItem("avatarSeed")??window.crypto.randomUUID()})},onCleanUp(){}}),ce=m("<img alt=avatar draggable=false>"),le=m("<button>"),{localPlayer:I,setLocalPlayer:ie}=M();function me(o){const e=w(()=>{if(I!=null&&I.avatarSeed)return`https://api.dicebear.com/7.x/lorelei/svg?seed=${I.avatarSeed}`});return(()=>{const t=i(le);return v(t,E(o,{id:"avatar_selector_button",class:"container border-3 border-dashed shadow shadow-small",style:{"font-size":"x-large","max-width":"28ch","aspect-ratio":1,height:"auto"},onClick:de}),!1,!0),p(t,u(W,{get when(){return e()},get children(){const n=i(ce);return n.style.setProperty("margin","0"),n.style.setProperty("border","0"),U(()=>V(n,"src",e())),n}})),g(),t})()}function de(){ie("avatarSeed",window.crypto.randomUUID())}const[B,ue]=G(),{Provider:ge,use:j}=x({Peer:B,createPeer:he},{onMount:()=>re(()=>import("../chunks/chunk-C7zfqIA9.js"),__vite__mapDeps([])).then(o=>ue(()=>o.default))});function he(...o){const e=B();if(!e)throw new Error("Peer used before ready");return new e(...o)}const pe=(o,e)=>{const{peer:t}=o,{nickname:n,avatarSeed:r}=e,{room:a,setRoom:c}=_();console.log("Initialising player",{playerId:t,...e}),c("players",s=>s.map(l=>l.id!==t?l:{...l,nickname:n,avatarSeed:r})),console.table(a.players)},fe=(o,e)=>{const{message:t}=e;console.log(`Message from {${o.peer}}:`,`"${t}"`)},O={PLAYER_INITIALISE:pe,MESSAGE:fe},[ve,A]=C({players:[]}),{Provider:ye,use:_}=x({room:ve,setRoom:A},{onInit(){},onMount(){const e=new URLSearchParams(document.location.search).get("room");A({id:e??void 0,isHost:e===null})},onCleanUp(){}});function T(){const{room:o,setRoom:e}=_(),{createPeer:t}=j(),{localPlayer:n}=M(),r=t(n.id),a=o.id;r.on("error",c=>{console.warn({roomId:a,error:c}),e("error",c),r.destroy()}).on("open",()=>{console.log("Connecting to room",{roomId:a});const c=r.connect(a);c.on("open",()=>{console.log("Connected to room",{roomId:a}),e("connection",c)}).on("close",()=>{console.log("Disconnected from room",{roomId:a})}).on("error",s=>{console.warn("Local Player Room error",{roomId:a,error:s}),e("error",s)}).on("data",s=>{console.log("Data from room",{roomId:a,data:s});const{messageType:l,payload:h}=s;if(l===void 0){const b=new Error("Malformed data from room",{cause:{roomId:a,data:s}});console.warn(b),e("error",b);return}O[l](c,h)})})}const we=m("<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><style>@keyframes spinner_xe7Q{93.75%,to{r:3px}46.875%{r:.2px}}.spinner_b2T7{animation:spinner_xe7Q .8s linear infinite}</style><circle cx=4 cy=12 r=3 class=spinner_b2T7></circle><circle cx=12 cy=12 r=3 class=spinner_b2T7 style=animation-delay:-.65s></circle><circle cx=20 cy=12 r=3 class=spinner_b2T7 style=animation-delay:-.5s>"),_e=(o={})=>(()=>{const e=i(we);return v(e,o,!0,!0),g(),e})(),$e=m("<button>"),{room:L}=_();function Se(o){const{loading:e=()=>!0}=o,t=w(()=>w(()=>e()?_e:`âš” ${L!=null&&L.isHost?"Host":"Join"} Room`));return(()=>{const n=i($e);return v(n,E(o,{id:"enter_room_button",class:"btn-secondary-outline",style:"fill:var(--secondary); min-width: 11ch; max-width: fit-content; font-size: xx-large; font-variant: small-caps"}),!1,!0),p(n,t),g(),n})()}const xe=m("<input>");function be(o){const{localPlayer:e,setLocalPlayer:t}=M();return(()=>{const n=i(xe);return v(n,E(o,{id:"nickname_name_input",type:"text",placeholder:"nickname goes here â™¥",class:"container border-3 border-dashed shadow shadow-hover shadow-small",maxlength:"24",style:{"text-align":"center","font-size":"x-large","max-width":"28ch"},get value(){return e==null?void 0:e.nickname},onInput:r=>t("nickname",r.target.value)}),!1,!1),g(),n})()}const Pe=()=>{const{room:o,setRoom:e}=_();return{hostRoom:o,setHostRoom:e}};function Ie(){console.log("Creating Host Room");const{hostRoom:o,setHostRoom:e}=Pe(),{createPeer:t}=j(),n=t(o.id);return n.on("error",r=>{console.warn("Host Room Peer error",{error:r}),n.destroy()}).on("open",r=>{console.log("Room opened",{roomId:r}),e("id",r)}).on("connection",r=>{const a=r.peer;console.log("Player connecting",{playerId:a}),r.on("open",()=>{console.log("Player connected",{playerId:a});const c={id:a,connection:r};e("players",s=>[...s,c])}).on("close",()=>{console.log("Player disconnected",{playerId:a})}).on("error",c=>console.warn("Player connection error",{playerId:a,error:c})).on("data",c=>{const{messageType:s,payload:l}=c;if(s===void 0){console.warn("Malformed data from player",{playerId:a,data:c});return}O[s](r,l)})}),{hostRoom:o,setHostRoom:e}}const Ce=m("<section><!$><!/><!$><!/>");function F(){const{localPlayer:o}=M(),{room:e}=_(),{UI:t,setUI:n}=k(),[r,a]=G(!1);w(y(()=>e.connection,()=>n("scene",{name:"Lobby"}),{defer:!0})),f(y(()=>e.id,()=>{e.isHost&&T()},{defer:!0})),f(y(()=>e.error,s=>{switch(s.type??s.name){case"peer-unavailable":{n("alert",{show:!0,level:"alert-warning",innerHTML:"Could not connect to room ðŸ¤”"});break}default:n("alert",{show:!0,level:"alert-danger",innerHTML:s.message})}},{defer:!0})),f(()=>{t.alert.show||a(!1)});function c(){a(!0);const{room:s}=_();s.isHost?Ie():T()}return[(()=>{const s=i(Ce),l=s.firstChild,[h,b]=S(l.nextSibling),J=h.nextSibling,[Q,Y]=S(J.nextSibling);return p(s,u(me,{get disabled(){return r()}}),h,b),p(s,u(be,{get disabled(){return r()}}),Q,Y),s})(),u(Se,{get disabled(){return!(o!=null&&o.nickname)||r()},onclick:c,loading:r})]}function Me(){return"Game Layout"}function ke(){const{room:o}=_();return D(()=>{new URLSearchParams(document.location.search).get("room")==null&&history.pushState({},"",`?room=${o.id}`)}),"Lobby Layout"}const Le=["light","dark"],Re=Le,R=["system",...Re],Ee={Entry:F,Lobby:ke,Game:Me},[d,$]=C({colorScheme:{isDark:!1,setting:"system",toggleSetting:Ae},scene:{name:"Entry",component:F},alert:{show:!1,level:"alert-warning",innerHTML:"Hello, world!"}}),{Provider:Ue,use:k}=x({UI:d,setUI:$},{onInit(){N(["colorSchemeSetting",()=>d.colorScheme.setting]),f(y(()=>d.colorScheme.isDark,()=>{d.colorScheme.isDark?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},{defer:!1})),f(()=>{$("colorScheme","isDark",d.colorScheme.setting!=="system"?d.colorScheme.setting==="dark":He()??d.colorScheme.isDark)}),f(y(()=>d.scene.name,()=>$("scene",{component:Ee[d.scene.name]}),{defer:!0}))},onMount(){const o=localStorage.getItem("colorSchemeSetting")??d.colorScheme.setting;$("colorScheme","setting",o),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:e})=>{d.colorScheme.setting==="system"&&$("colorScheme",{isDark:e})})},onCleanUp(){}});function He(){if(window.matchMedia!==void 0)return window.matchMedia("(prefers-color-scheme: dark)").matches}function Ae(){const e=(R.indexOf(d.colorScheme.setting)+1)%R.length;$("colorScheme","setting",R[e])}const Te=m("<dialog><input id=alertModal class=alert-state type=checkbox><div><!$><!/><label class=btn-close for=alertModal>"),De=()=>{const{UI:o,setUI:e}=k();return f(y(()=>o.alert.show,()=>{var t,n;o.alert.show?(t=o.alert.dialogRef)==null||t.showModal():(n=o.alert.dialogRef)==null||n.close()},{defer:!0})),f(()=>o.alert.dialogRef.addEventListener("close",()=>e("alert",{show:!1}))),(()=>{const t=i(Te),n=t.firstChild,r=n.nextSibling,a=r.firstChild,[c,s]=S(a.nextSibling),l=c.nextSibling;return Z(h=>e("alert",{dialogRef:h}),t),p(r,()=>o.alert.innerHTML,c,s),l.$$click=()=>{var h;return(h=o.alert.dialogRef)==null?void 0:h.close()},ee(l,"innerText","X"),U(()=>oe(r,"alert  "+o.alert.level)),g(),t})()};z(["click"]);function Ve(o){const{components:e=[],children:t}=o;return w(()=>e.reduceRight((n,r)=>u(r,{children:n}),t))}const[Ge,ze]=C({}),{Provider:Ne,use:mo}=x({game:Ge,setGame:ze},{onInit(){},onMount(){},onCleanUp(){}}),Be=[Ne,ae,ge,ye,Ue];const je=m('<footer><p xmlns:cc=http://creativecommons.org/ns# xmlns:dct=http://purl.org/dc/terms/><a rel=cc:attributionURL property=dct:title href=https://github.com/jgrunik/upgrade>Upgrade</a>&nbsp;by&nbsp;<a rel="cc:attributionURL dct:creator"property=cc:attributionName href=https://github.com/jgrunik>Joshua Grunik</a>&nbsp;is licensed under&nbsp;<a rel="license noopener noreferrer"href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a><br><span style=display:inline-flex;height:2ch><img src=https://mirrors.creativecommons.org/presskit/icons/cc.svg><img src=https://mirrors.creativecommons.org/presskit/icons/by.svg><img src=https://mirrors.creativecommons.org/presskit/icons/nc.svg><img src=https://mirrors.creativecommons.org/presskit/icons/sa.svg>'),Oe=()=>i(je),Fe=m('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=none stroke=currentColor stroke-width=0 style=overflow:visible;color:currentcolor viewBox="0 0 24 24"><path fill=currentColor fill-rule=evenodd stroke=none d="M2.25 5.25a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3V15a3 3 0 0 1-3 3h-3v.257c0 .597.237 1.17.659 1.591l.621.622a.75.75 0 0 1-.53 1.28h-9a.75.75 0 0 1-.53-1.28l.621-.622a2.25 2.25 0 0 0 .659-1.59V18h-3a3 3 0 0 1-3-3zm1.5 0v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5"clip-rule=evenodd>'),Je=(o={})=>(()=>{const e=i(Fe);return v(e,o,!0,!0),g(),e})(),Qe=m('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=currentColor stroke-width=0 style=overflow:visible;color:currentcolor viewBox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732z">'),Ye=(o={})=>(()=>{const e=i(Qe);return v(e,o,!0,!0),g(),e})(),qe=m('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=currentColor stroke-width=0 style=overflow:visible;color:currentcolor viewBox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708">'),Xe=(o={})=>(()=>{const e=i(qe);return v(e,o,!0,!0),g(),e})(),Ke=m('<button class="card border"style=margin-right:0;margin:0;padding:0.5rem>'),We={system:Je,dark:Ye,light:Xe};function Ze(){const{UI:o}=k(),e=w(()=>We[o.colorScheme.setting]);return(()=>{const t=i(Ke);return te(t,"click",o.colorScheme.toggleSetting,!0),p(t,e),U(()=>V(t,"popover-left",`color scheme '${o.colorScheme.setting}'`)),g(),t})()}z(["click"]);const eo=m('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=currentColor stroke-width=0 style=overflow:visible;color:currentcolor viewBox="0 0 16 16"><path d="M12.775 5.44C9.751 3.192 8.708 1.393 8.001 0c-.708 1.393-1.75 3.192-4.774 5.44-5.157 3.833-.303 9.182 3.965 6.238-.278 1.827-1.227 3.159-2.191 3.733v.59h6v-.59c-.964-.574-1.913-1.906-2.191-3.733 4.268 2.944 9.122-2.405 3.965-6.238">'),oo=(o={})=>(()=>{const e=i(eo);return v(e,o,!0,!0),g(),e})();const to=m("<header class=not-selectable><h1><!$><!/> Upgrade</h1><!$><!/>"),no=()=>(()=>{const o=i(to),e=o.firstChild,t=e.firstChild,[n,r]=S(t.nextSibling);n.nextSibling;const a=e.nextSibling,[c,s]=S(a.nextSibling);return p(e,oo,n,r),p(o,u(Ze,{}),c,s),o})(),ro=m("<main>"),{UI:so}=k();function ao(){return u(Ve,{components:Be,get children(){return[u(no,{}),(()=>{const o=i(ro);return p(o,()=>so.scene.component()),o})(),u(Oe,{}),u(De,{})]}})}const co=Object.freeze(Object.defineProperty({__proto__:null,default:ao},Symbol.toStringTag,{value:"Module"})),uo=[{configName:"onRenderClient",importPath:"/renderer/+onRenderClient.tsx",isValueFile:!0,exportValues:ne},{configName:"Page",importPath:"/pages/index/+Page.tsx",isValueFile:!0,exportValues:co}],go={onBeforeRenderEnv:{definedAt:{isComputed:!0},valueSerialized:"null"}};export{uo as configValuesImported,go as configValuesSerialized};
//# sourceMappingURL=pages_index.mhmA10GK.js.map
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}