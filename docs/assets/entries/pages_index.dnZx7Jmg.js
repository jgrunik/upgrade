import{g as i,t as l,o as J,a as Y,c as u,u as q,b as K,d as h,e as f,f as x,h as P,s as $,m as O,j as w,k as j,S as Q,r as v,l as V,n as W,p as M,q as X,v as Z,i as ee}from"../chunks/chunk-6itN8lrJ.js";import{_ as oe}from"../chunks/chunk-9zjs2ake.js";const te=l('<footer><p xmlns:cc=http://creativecommons.org/ns# xmlns:dct=http://purl.org/dc/terms/><a rel=cc:attributionURL property=dct:title href=https://github.com/jgrunik/upgrade>Upgrade</a>&nbsp;by&nbsp;<a rel="cc:attributionURL dct:creator"property=cc:attributionName href=https://github.com/jgrunik>Joshua Grunik</a>&nbsp;is licensed under&nbsp;<a rel="license noopener noreferrer"href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a><br><span style=display:inline-flex;height:2ch><img src=https://mirrors.creativecommons.org/presskit/icons/cc.svg><img src=https://mirrors.creativecommons.org/presskit/icons/by.svg><img src=https://mirrors.creativecommons.org/presskit/icons/nc.svg><img src=https://mirrors.creativecommons.org/presskit/icons/sa.svg>'),ne=()=>i(te);function b(o,e={}){const t=K(o);function n(s){var c;return(c=e.onInit)==null||c.call(e),J(()=>{var a;return(a=e.onMount)==null?void 0:a.call(e)}),Y(()=>{var a;return(a=e.onCleanUp)==null?void 0:a.call(e)}),u(t.Provider,{value:o,get children(){return s.children}})}function r(){const s=q(t);if(s===void 0)throw new Error("use() must be used within a Context.Provider");return s}return{Provider:n,use:r}}function z(...o){o==null||o.forEach(([e,t])=>re(e,t))}function re(o,e){h(f(e,()=>localStorage.setItem(o,e()),{defer:!0}))}const[I,D]=x(),{Provider:se,use:C}=b({localPlayer:I,setLocalPlayer:D},{onInit(){z(["playerId",()=>I.id],["nickname",()=>I.nickname],["avatarSeed",()=>I.avatarSeed])},onMount(){D({id:localStorage.getItem("playerId")??window.crypto.randomUUID(),nickname:localStorage.getItem("nickname")??"",avatarSeed:localStorage.getItem("avatarSeed")??window.crypto.randomUUID()})},onCleanUp(){}}),ce=l("<img alt=avatar draggable=false>"),ae=l("<button>"),{localPlayer:k,setLocalPlayer:ie}=C();function le(o){const e=P(()=>{if(k!=null&&k.avatarSeed)return`https://api.dicebear.com/7.x/lorelei/svg?seed=${k.avatarSeed}`});return(()=>{const t=i(ae);return $(t,O(o,{id:"avatar_selector_button",class:"container border-3 border-dashed shadow shadow-small",style:{"font-size":"x-large","max-width":"28ch","aspect-ratio":1,height:"auto"},onClick:me}),!1,!0),w(t,u(Q,{get when(){return e()},get children(){const n=i(ce);return n.style.setProperty("margin","0"),n.style.setProperty("border","0"),j(()=>V(n,"src",e())),n}})),v(),t})()}function me(){ie("avatarSeed",window.crypto.randomUUID())}const[de,H]=x({players:[]}),{Provider:ue,use:y}=b({room:de,setRoom:H},{onInit(){},onMount(){const e=new URLSearchParams(document.location.search).get("room");H({id:e??window.crypto.randomUUID(),isHost:e===null})},onCleanUp(){}}),ge=l("<button>"),{room:U}=y();function pe(o){const e=P(()=>`⚔ ${U!=null&&U.isHost?"Host":"Join"} Room`);return(()=>{const t=i(ge);return $(t,O(o,{id:"enter_room_button",class:"btn-secondary-outline",style:"max-width: fit-content; font-size: xx-large; font-variant: small-caps",get innerText(){return e()}}),!1,!1),v(),t})()}const he=l("<input>");function fe(o){const{localPlayer:e,setLocalPlayer:t}=C();return(()=>{const n=i(he);return $(n,O(o,{id:"nickname_name_input",type:"text",placeholder:"nickname goes here ♥",class:"container border-3 border-dashed shadow shadow-hover shadow-small",maxlength:"24",style:{"text-align":"center","font-size":"x-large","max-width":"28ch"},get value(){return e==null?void 0:e.nickname},onInput:r=>t("nickname",r.target.value)}),!1,!1),v(),n})()}const ve=(o,e)=>{const{peer:t}=o,{nickname:n,avatarSeed:r}=e,{room:s,setRoom:c}=y();console.log("Initialising player",{playerId:t,...e}),c("players",a=>a.map(_=>_.id!==t?_:{..._,nickname:n,avatarSeed:r})),console.table(s.players)},we=(o,e)=>{const{message:t}=e;console.log(`Message from {${o.peer}}:`,`"${t}"`)},B={PLAYER_INITIALISE:ve,MESSAGE:we},[g,p]=x({connect:Se,isConnected:!1}),{localPlayer:T,setLocalPlayer:$e}=C(),{room:m,setRoom:R}=y(),{Provider:ye,use:_e}=b({network:g,setNetwork:p},{onInit(){h(f(()=>m.peer,be,{defer:!0})),h(f([()=>T.peer,()=>m.isOpen],()=>{if(!m.isHost)return N();m.isOpen&&N()},{defer:!0})),h(f([()=>m.connection,()=>m.isOpen],()=>p("isConnected",!g.error&&!!m.connection&&(!m.isHost||m.isOpen)),{defer:!0})),h(f(()=>g.warning,()=>{const{message:o,context:e}=g.warning;console.warn(o,e)},{defer:!0})),h(f(()=>g.error,()=>{const{message:o,context:e}=g.error;console.error(o,e)},{defer:!0}))},async onMount(){const o=(await oe(()=>import("../chunks/chunk-0Ct39pI4.js"),__vite__mapDeps([]))).default;p("PeerObject",()=>o)},onCleanUp(){}});function Se(){const{room:o}=y();o.isHost&&xe(),Pe(),p("isConnected",g.error===void 0)}function xe(){R("peer",new g.PeerObject(m.id))}function Pe(){$e("peer",new g.PeerObject(T.id))}function be(){m.peer.on("open",o=>{console.log("Room opened",{roomId:o}),R("isOpen",!0)}).on("connection",o=>{const e=o.peer;console.log("Player connected",{playerId:e}),o.on("open",()=>{console.log("Player connection open",{playerId:e});const t={id:e,connection:o};R("players",n=>[...n,t])}).on("close",()=>{console.log("Player disconnected",{playerId:e})}).on("error",t=>{p("warning",{message:"Player connection error",context:{playerId:e,error:t}})}).on("data",t=>{const{messageType:n,payload:r}=t;if(n===void 0){p("warning",{message:"Malformed data from player",context:{playerId:e,data:t}});return}B[n](o,r)})})}function N(){const{localPlayer:o}=C(),{room:e,setRoom:t}=y(),n=e.id;o.peer.on("error",(s,c)=>{console.log(o.peer),p("error",{message:"Local Player error starting Peer object",context:{error:s,context:c}})}).on("connection",s=>{console.log("Connection from",{id:s.peer})}),console.log("Connecting to room",{roomId:n});const r=o.peer.connect(n);r.on("open",()=>{console.log("Connected to room",{roomId:n}),t("connection",r)}).on("close",()=>{console.log("Disconnected from room",{roomId:n})}).on("error",s=>{p("error",{message:"Local Player error with room",context:{roomId:n,error:s}})}).on("data",s=>{console.log("Data from room",{roomId:n,data:s});const{messageType:c,payload:a}=s;if(c===void 0){p("error",{message:"Malformed data from room",context:{roomId:n,data:s}});return}B[c](r,a)})}const Ce=l("<section><!$><!/><!$><!/>"),{localPlayer:E}=C(),{room:Ie}=y(),{network:ke}=_e();function Me(){const{setUI:o}=A(),[e,t]=W("Unattempted");P(f(()=>Ie.connection,()=>{console.log("ROOM CONNECTION!"),o("scene",{name:"Lobby"})},{defer:!0}));function n(){t("Pending"),ke.connect()}return[(()=>{const r=i(Ce),s=r.firstChild,[c,a]=M(s.nextSibling),_=c.nextSibling,[F,G]=M(_.nextSibling);return w(r,u(le,{get disabled(){return e()=="Pending"}}),c,a),w(r,u(fe,{get disabled(){return e()=="Pending"}}),F,G),r})(),u(pe,{get disabled(){return!(E!=null&&E.nickname)||e()=="Pending"},onclick:n})]}const Ue=["light","dark"],Ee=Ue,L=["system",...Ee],[d,S]=x({colorScheme:{isDark:!1,setting:"system"},scene:{name:"Entry",component:Me}}),{Provider:Le,use:A}=b({UI:d,setUI:S},{onInit(){z(["colorSchemeSetting",()=>d.colorScheme.setting]),h(f(()=>d.colorScheme.isDark,()=>{d.colorScheme.isDark?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},{defer:!1})),h(()=>{S("colorScheme","isDark",d.colorScheme.setting!=="system"?d.colorScheme.setting==="dark":Re()??d.colorScheme.isDark)})},onMount(){const o=localStorage.getItem("colorSchemeSetting")??d.colorScheme.setting;S("colorScheme","setting",o),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:e})=>{d.colorScheme.setting==="system"&&S("colorScheme",{isDark:e})})},onCleanUp(){}});function Re(){if(window.matchMedia!==void 0)return window.matchMedia("(prefers-color-scheme: dark)").matches}function Oe(){const e=(L.indexOf(d.colorScheme.setting)+1)%L.length;S("colorScheme","setting",L[e])}const Ae=l('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=none stroke=currentColor stroke-width=0 style=overflow:visible;color:currentcolor viewBox="0 0 24 24"><path fill=currentColor fill-rule=evenodd stroke=none d="M2.25 5.25a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3V15a3 3 0 0 1-3 3h-3v.257c0 .597.237 1.17.659 1.591l.621.622a.75.75 0 0 1-.53 1.28h-9a.75.75 0 0 1-.53-1.28l.621-.622a2.25 2.25 0 0 0 .659-1.59V18h-3a3 3 0 0 1-3-3zm1.5 0v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5"clip-rule=evenodd>'),De=(o={})=>(()=>{const e=i(Ae);return $(e,o,!0,!0),v(),e})(),He=l('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=currentColor stroke-width=0 style=overflow:visible;color:currentcolor viewBox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732z">'),Ne=(o={})=>(()=>{const e=i(He);return $(e,o,!0,!0),v(),e})(),je=l('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=currentColor stroke-width=0 style=overflow:visible;color:currentcolor viewBox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708">'),Ve=(o={})=>(()=>{const e=i(je);return $(e,o,!0,!0),v(),e})(),ze=l('<button class="card border"style=margin-right:0;margin:0;padding:0.5rem>'),Be={system:De,dark:Ne,light:Ve};function Te(){const{UI:o}=A(),e=P(()=>Be[o.colorScheme.setting]);return(()=>{const t=i(ze);return Z(t,"click",Oe,!0),w(t,e),j(()=>V(t,"popover-left",`color scheme '${o.colorScheme.setting}'`)),v(),t})()}X(["click"]);const Fe=l('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=currentColor stroke-width=0 style=overflow:visible;color:currentcolor viewBox="0 0 16 16"><path d="M12.775 5.44C9.751 3.192 8.708 1.393 8.001 0c-.708 1.393-1.75 3.192-4.774 5.44-5.157 3.833-.303 9.182 3.965 6.238-.278 1.827-1.227 3.159-2.191 3.733v.59h6v-.59c-.964-.574-1.913-1.906-2.191-3.733 4.268 2.944 9.122-2.405 3.965-6.238">'),Ge=(o={})=>(()=>{const e=i(Fe);return $(e,o,!0,!0),v(),e})();const Je=l("<header class=not-selectable><h1><!$><!/> Upgrade</h1><!$><!/>"),Ye=()=>(()=>{const o=i(Je),e=o.firstChild,t=e.firstChild,[n,r]=M(t.nextSibling);n.nextSibling;const s=e.nextSibling,[c,a]=M(s.nextSibling);return w(e,Ge,n,r),w(o,u(Te,{}),c,a),o})();function qe(o){const{components:e=[],children:t}=o;return P(()=>e.reduceRight((n,r)=>u(r,{children:n}),t))}const[Ke,Qe]=x({}),{Provider:We,use:so}=b({game:Ke,setGame:Qe},{onInit(){},onMount(){},onCleanUp(){}}),Xe=l("<main>"),Ze=[Le,se,ue,ye,We],{UI:eo}=A();function oo(){return u(qe,{components:Ze,get children(){return[u(Ye,{}),(()=>{const o=i(Xe);return w(o,()=>eo.scene.component()),o})(),u(ne,{})]}})}const to=Object.freeze(Object.defineProperty({__proto__:null,default:oo},Symbol.toStringTag,{value:"Module"})),co=[{configName:"onRenderClient",importPath:"/renderer/+onRenderClient.tsx",isValueFile:!0,exportValues:ee},{configName:"Page",importPath:"/pages/index/+Page.tsx",isValueFile:!0,exportValues:to}],ao={onBeforeRenderEnv:{definedAt:{isComputed:!0},valueSerialized:"null"}};export{co as configValuesImported,ao as configValuesSerialized};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}