import{o as N,a as ee,c as m,u as te,b as oe,d as B,e as L,f as _,h as b,g as c,s as v,m as U,j as u,k as S,l as C,S as ne,r as f,t as i,n as $,p as P,q as A,F as V,I as re,v as F,w as se,x as ae,y as le,i as ce}from"../chunks/chunk-Qoj3Hw_b.js";import{_ as ie}from"../chunks/chunk-GgBbLaes.js";function R(t,e={}){const o=oe(t);function n(s){var l;let a=(l=e.onInit)==null?void 0:l.call(e,s);return N(()=>{var d;a=(d=e.onMount)==null?void 0:d.call(e,a)}),ee(()=>{var d;return(d=e.onCleanUp)==null?void 0:d.call(e,a)}),m(o.Provider,{value:t,get children(){return s.children}})}function r(){const s=te(o);if(s===void 0)throw new Error("use() must be used within a Context.Provider");return s}return{Provider:n,use:r}}const[j,de]=B(),{Provider:me,use:D}=R({Peer:j,createPeer:ue},{onMount:()=>ie(()=>import("../chunks/chunk-C7zfqIA9.js"),__vite__mapDeps([])).then(t=>de(()=>t.default))});function ue(...t){const e=j();if(!e)throw new Error("PeerJS referenced before imported");return new e(...t)}const[ge,z]=L({players:[]}),{Provider:he,use:w}=R({room:ge,setRoom:z},{onInit(){},onMount(){const e=new URLSearchParams(document.location.search).get("room");z({id:e??void 0,isHost:e===null})},onCleanUp(){}});function pe(){console.log("Creating Host Room");const{hostRoom:t,setHostRoom:e}=J(),{Peer:o}=D(),n=new(o())(t.id);return n.on("error",r=>{console.warn("Host Room Peer error",{error:r}),n.destroy()}).on("open",r=>{console.log("Room opened",{roomId:r}),e("id",r)}).on("connection",r=>{const s=r.peer;console.log("Peer connecting",{peerId:s}),r.on("open",()=>{console.log("Peer connected",{peerId:s});const a={connection:r};e("players",l=>[...l,a])}).on("close",()=>{console.log("Player disconnected",{peerId:s}),e("players",a=>a.filter(({connection:l})=>(l==null?void 0:l.peer)!==s))}).on("error",a=>console.warn("Player connection error",{peerId:s,error:a})).on("data",a=>{const{type:l,payload:d}=a;if(l===void 0){console.warn("Malformed data from player",{peerId:s,data:a});return}Y[l](r,d)})}),{hostRoom:t,setHostRoom:e}}const J=()=>{const{room:t,setRoom:e}=w();return{hostRoom:t,setHostRoom:e}},fe={PLAYER_INITIAL_INFO:(t,e)=>{const{peer:o}=t,{hostRoom:n,setHostRoom:r}=J();console.log("Initialising player"),console.table({peerId:o,...e}),r("players",n.players.findIndex(s=>s.connection==t),s=>({...s,...e})),t.send(new Q("ROOM_UPDATE",{players:n.players.map(s=>({id:s.id,nickname:s.nickname,avatarSeed:s.avatarSeed}))}))}},ve={ROOM_UPDATE:function(e,o){const{setRoom:n}=w();n(o),console.log("Room Update received"),console.table(o)}},Y={...fe,...ve};class Q{constructor(e,o){return{type:e,payload:o}}}function q(...t){t==null||t.forEach(([e,o])=>_e(e,o))}function _e(t,e){_(b(e,()=>localStorage.setItem(t,e()),{defer:!0}))}const[x,T]=L(),{Provider:$e,use:O}=R({localPlayer:x,setLocalPlayer:T},{onInit(){q(["playerId",()=>x.id],["nickname",()=>x.nickname],["avatarSeed",()=>x.avatarSeed])},onMount(){D(),T({id:localStorage.getItem("playerId")??window.crypto.randomUUID(),nickname:localStorage.getItem("nickname")??"",avatarSeed:localStorage.getItem("avatarSeed")??window.crypto.randomUUID()})},onCleanUp(){}});function G(){const t=D().Peer(),e=new t(window.crypto.randomUUID());T({peer:e});const{room:o,setRoom:n}=w(),r=o.id;e.on("error",s=>{console.warn({roomId:r,error:s}),n("error",s),e.destroy()}).on("open",()=>{console.log("Connecting to room",{roomId:r});const s=e.connect(r);s.on("open",()=>{console.log("Connected to room",{roomId:r}),n("connection",s),s.send(new Q("PLAYER_INITIAL_INFO",{id:x.id,nickname:x.nickname,avatarSeed:x.avatarSeed}))}).on("close",()=>{console.log("Disconnected from room",{roomId:r})}).on("error",a=>{console.warn("Local Player Room error",{roomId:r,error:a}),n("error",a)}).on("data",a=>{console.log("Data from room",{roomId:r,data:a});const{type:l,payload:d}=a;if(l===void 0){const g=new Error("Malformed data from room",{cause:{roomId:r,data:a}});console.warn(g),n("error",g);return}Y[l](s,d)})})}const we=i("<img alt=avatar draggable=false>"),ye=i("<button>"),{localPlayer:M,setLocalPlayer:Se}=O();function xe(t){const e=_(()=>{if(M!=null&&M.avatarSeed)return`https://api.dicebear.com/7.x/lorelei/svg?seed=${M.avatarSeed}`});return(()=>{const o=c(ye);return v(o,U(t,{id:"avatar_selector_button",class:"container border-3 border-dashed shadow shadow-small",style:{"font-size":"x-large","max-width":"28ch","aspect-ratio":1,height:"auto"},onClick:be}),!1,!0),u(o,m(ne,{get when(){return e()},get children(){const n=c(we);return n.style.setProperty("margin","0"),n.style.setProperty("border","0"),S(()=>C(n,"src",e())),n}})),f(),o})()}function be(){Se("avatarSeed",window.crypto.randomUUID())}const Pe=i("<svg xmlns=http://www.w3.org/2000/svg width=24 height=24><style>@keyframes spinner_xe7Q{93.75%,to{r:3px}46.875%{r:.2px}}.spinner_b2T7{animation:spinner_xe7Q .8s linear infinite}</style><circle cx=4 cy=12 r=3 class=spinner_b2T7></circle><circle cx=12 cy=12 r=3 class=spinner_b2T7 style=animation-delay:-.65s></circle><circle cx=20 cy=12 r=3 class=spinner_b2T7 style=animation-delay:-.5s>"),X=(t={})=>(()=>{const e=c(Pe);return v(e,t,!0,!0),f(),e})(),Ie=i("<button>"),{room:E}=w();function Ce(t){const{loading:e=()=>!0}=t,o=_(()=>_(()=>e()?X:`âš” ${E!=null&&E.isHost?"Host":"Join"} Room`));return(()=>{const n=c(Ie);return v(n,U(t,{id:"enter_room_button",class:"btn-secondary-outline",style:"fill:var(--secondary); min-width: 11ch; max-width: fit-content; font-size: xx-large; font-variant: small-caps"}),!1,!0),u(n,()=>t.children??o()),f(),n})()}const Re=i("<input>");function ke(t){const{localPlayer:e,setLocalPlayer:o}=O();return(()=>{const n=c(Re);return v(n,U(t,{id:"nickname_name_input",type:"text",placeholder:"nickname goes here",class:"container border-3 border-dashed shadow shadow-hover shadow-small",maxlength:"24",style:{"text-align":"center","font-size":"x-large","max-width":"28ch"},get value(){return e==null?void 0:e.nickname},onInput:r=>o("nickname",r.target.value)}),!1,!1),f(),n})()}const Me=i("<section><!$><!/><!$><!/>");function K(){const{localPlayer:t}=O(),{room:e}=w(),{UI:o,setUI:n}=k(),[r,s]=B(!1);_(b(()=>e.connection,()=>n("scene",{name:"Lobby"}),{defer:!0})),$(b(()=>e.id,()=>{e.isHost&&G()},{defer:!0})),$(()=>{o.alert.show||s(!1)});function a(){s(!0);const{room:l}=w();l.isHost?pe():G()}return[(()=>{const l=c(Me),d=l.firstChild,[g,y]=P(d.nextSibling),h=g.nextSibling,[W,Z]=P(h.nextSibling);return u(l,m(xe,{get disabled(){return r()}}),g,y),u(l,m(ke,{get disabled(){return r()}}),W,Z),l})(),m(Ce,{get disabled(){return!(t!=null&&t.nickname)||r()},onclick:a,loading:r})]}function Le(){return"Game Layout"}const Ue=i("<button>");function Ee(t){const{loading:e=()=>!0}=t,o=_(()=>_(()=>e()?X:"âš” Start Game"));return(()=>{const n=c(Ue);return v(n,U(t,{id:"start_game_button",class:"btn-secondary-outline",style:"fill:var(--secondary); min-width: 11ch; max-width: fit-content; font-size: xx-large; font-variant: small-caps"}),!1,!0),u(n,()=>t.children??o()),f(),n})()}const He=i('<div class="row flex-spaces tabs"><!$><!/><!$><!/>'),Te=i("<input type=radio name=tabs>"),Ae=i("<label>"),De=i("<div class=content>");function Oe(t){const e=t.activeTab??0;return(()=>{const o=c(He),n=o.firstChild,[r,s]=P(n.nextSibling),a=r.nextSibling,[l,d]=P(a.nextSibling);return u(o,m(V,{get each(){return t.tabs},children:(g,y)=>[(()=>{const h=c(Te);return S(()=>C(h,"id",`tab${y()+1}`)),S(()=>A(h,"checked",y()==e)),h})(),(()=>{const h=c(Ae);return u(h,()=>g.label),S(()=>C(h,"for",`tab${y()+1}`)),h})()]}),r,s),u(o,m(V,{get each(){return t.tabs},children:(g,y)=>(()=>{const h=c(De);return u(h,()=>g.content),S(()=>C(h,"id",`content${y()+1}`)),h})()}),l,d),o})()}const Ve=i('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=none stroke-width=0 style=overflow:visible;color:currentcolor viewBox="0 -4 24 24"><path fill=currentColor fill-rule=evenodd d="M7 3a4.002 4.002 0 0 1 3.874 3H19v2h-8.126A4.002 4.002 0 0 1 3 7a4 4 0 0 1 4-4m0 6a2 2 0 1 0 0-4 2 2 0 0 0 0 4m10 11a4.002 4.002 0 0 1-3.874-3H5v-2h8.126A4.002 4.002 0 0 1 21 16a4 4 0 0 1-4 4m0-2a2 2 0 1 0 0-4 2 2 0 0 0 0 4"clip-rule=evenodd>'),ze=(t={})=>(()=>{const e=c(Ve);return v(e,t,!0,!0),f(),e})(),Ge=i("<li>");function Ne(){const{room:t}=w();return N(()=>{new URLSearchParams(document.location.search).get("room")==null&&history.pushState({},"",`?room=${t.id}`)}),[m(Oe,{activeTab:0,get tabs(){return[{label:`${t.players.length} : Lobby`,content:m(re,{get each(){return t.players},children:(e,o)=>(()=>{const n=c(Ge);return n.style.setProperty("font-size","xx-large"),u(n,()=>e().nickname??`Player ${o+1} is joining...`),n})()})},{label:[ze," Options"],content:"settings..."}]}}),m(Ee,{loading:()=>!1})]}const Be=["light","dark"],Fe=Be,H=["system",...Fe],je={Entry:K,Lobby:Ne,Game:Le},[p,I]=L({colorScheme:{isDark:!1,setting:"system",toggleSetting:Qe},scene:{name:"Entry",component:K},alert:{show:!1,level:"alert-warning",innerHTML:"Hello, world!"}}),{Provider:Je,use:k}=R({UI:p,setUI:I},{onInit(){q(["colorSchemeSetting",()=>p.colorScheme.setting]),$(b(()=>p.colorScheme.isDark,()=>{p.colorScheme.isDark?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},{defer:!1})),$(()=>{I("colorScheme","isDark",p.colorScheme.setting!=="system"?p.colorScheme.setting==="dark":Ye()??p.colorScheme.isDark)}),$(b(()=>p.scene.name,()=>I("scene",{component:je[p.scene.name]}),{defer:!0}))},onMount(){const t=localStorage.getItem("colorSchemeSetting")??p.colorScheme.setting;I("colorScheme","setting",t),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:e})=>{p.colorScheme.setting==="system"&&I("colorScheme",{isDark:e})})},onCleanUp(){}});function Ye(){if(window.matchMedia!==void 0)return window.matchMedia("(prefers-color-scheme: dark)").matches}function Qe(){const e=(H.indexOf(p.colorScheme.setting)+1)%H.length;I("colorScheme","setting",H[e])}const qe=i("<dialog><input id=alertModal class=alert-state type=checkbox><div><!$><!/><label class=btn-close for=alertModal>"),Xe=()=>{const{UI:t,setUI:e}=k();return $(b(()=>t.alert.show,()=>{var o,n;t.alert.show?(o=t.alert.dialogRef)==null||o.showModal():(n=t.alert.dialogRef)==null||n.close()},{defer:!0})),$(()=>t.alert.dialogRef.addEventListener("close",()=>e("alert",{show:!1}))),(()=>{const o=c(qe),n=o.firstChild,r=n.nextSibling,s=r.firstChild,[a,l]=P(s.nextSibling),d=a.nextSibling;return se(g=>e("alert",{dialogRef:g}),o),u(r,()=>t.alert.innerHTML,a,l),d.$$click=()=>{var g;return(g=t.alert.dialogRef)==null?void 0:g.close()},A(d,"innerText","X"),S(()=>ae(r,"alert  "+t.alert.level)),f(),o})()};F(["click"]);function Ke(t){const{components:e=[],children:o}=t;return _(()=>e.reduceRight((n,r)=>m(r,{children:n}),o))}const[We,Ze]=L({}),{Provider:et,use:bt}=R({game:We,setGame:Ze},{onInit(){},onMount(){},onCleanUp(){}}),tt=[et,$e,me,he,Je];const ot=i('<footer><p xmlns:cc=http://creativecommons.org/ns# xmlns:dct=http://purl.org/dc/terms/><a rel=cc:attributionURL property=dct:title href=https://github.com/jgrunik/upgrade>Upgrade</a>&nbsp;is licenced under<a style=display:inline-flex;margin-left:0.5ch; rel="license noopener noreferrer"href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank></a><span style=display:inline-flex;height:1.75ch;margin-left:0.5ch;><img src=https://mirrors.creativecommons.org/presskit/icons/cc.svg><img src=https://mirrors.creativecommons.org/presskit/icons/by.svg><img src=https://mirrors.creativecommons.org/presskit/icons/nc.svg><img src=https://mirrors.creativecommons.org/presskit/icons/sa.svg>'),nt=()=>(()=>{const t=c(ot),e=t.firstChild,o=e.firstChild,n=o.nextSibling,r=n.nextSibling;return A(r,"innerText","CC BY-NC-SA 4.0"),t})(),rt=i('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=none stroke=currentColor stroke-width=0 style=overflow:visible;color:currentcolor viewBox="0 0 24 24"><path fill=currentColor fill-rule=evenodd stroke=none d="M2.25 5.25a3 3 0 0 1 3-3h13.5a3 3 0 0 1 3 3V15a3 3 0 0 1-3 3h-3v.257c0 .597.237 1.17.659 1.591l.621.622a.75.75 0 0 1-.53 1.28h-9a.75.75 0 0 1-.53-1.28l.621-.622a2.25 2.25 0 0 0 .659-1.59V18h-3a3 3 0 0 1-3-3zm1.5 0v7.5a1.5 1.5 0 0 0 1.5 1.5h13.5a1.5 1.5 0 0 0 1.5-1.5v-7.5a1.5 1.5 0 0 0-1.5-1.5H5.25a1.5 1.5 0 0 0-1.5 1.5"clip-rule=evenodd>'),st=(t={})=>(()=>{const e=c(rt);return v(e,t,!0,!0),f(),e})(),at=i('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=currentColor stroke-width=0 style=overflow:visible;color:currentcolor viewBox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732z">'),lt=(t={})=>(()=>{const e=c(at);return v(e,t,!0,!0),f(),e})(),ct=i('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=currentColor stroke-width=0 style=overflow:visible;color:currentcolor viewBox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708">'),it=(t={})=>(()=>{const e=c(ct);return v(e,t,!0,!0),f(),e})(),dt=i('<button class="card border"style=margin-right:0;margin:0;padding:0.5rem>'),mt={system:st,dark:lt,light:it};function ut(){const{UI:t}=k(),e=_(()=>mt[t.colorScheme.setting]);return(()=>{const o=c(dt);return le(o,"click",t.colorScheme.toggleSetting,!0),u(o,e),S(()=>C(o,"popover-left",`color scheme '${t.colorScheme.setting}'`)),f(),o})()}F(["click"]);const gt=i('<svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=currentColor stroke-width=0 style=overflow:visible;color:currentcolor viewBox="0 0 16 16"><path d="M12.775 5.44C9.751 3.192 8.708 1.393 8.001 0c-.708 1.393-1.75 3.192-4.774 5.44-5.157 3.833-.303 9.182 3.965 6.238-.278 1.827-1.227 3.159-2.191 3.733v.59h6v-.59c-.964-.574-1.913-1.906-2.191-3.733 4.268 2.944 9.122-2.405 3.965-6.238">'),ht=(t={})=>(()=>{const e=c(gt);return v(e,t,!0,!0),f(),e})();const pt=i("<header class=not-selectable><h1><!$><!/> Upgrade</h1><!$><!/>"),ft=()=>(()=>{const t=c(pt),e=t.firstChild,o=e.firstChild,[n,r]=P(o.nextSibling);n.nextSibling;const s=e.nextSibling,[a,l]=P(s.nextSibling);return u(e,ht,n,r),u(t,m(ut,{}),a,l),t})(),vt=i("<main>"),{UI:_t}=k(),{room:$t}=w();function wt(){const{setUI:t}=k();return $(b(()=>$t.error,e=>{switch(e.type??e.name){case"peer-unavailable":{t("alert",{show:!0,level:"alert-warning",innerHTML:"Could not connect to room ðŸ¤”"});break}case"unavailable-id":{t("alert",{show:!0,level:"alert-warning",innerHTML:"You are already in a room ðŸ¤”"});break}default:t("alert",{show:!0,level:"alert-danger",innerHTML:e.message})}},{defer:!0})),m(Ke,{components:tt,get children(){return[m(ft,{}),(()=>{const e=c(vt);return u(e,()=>_t.scene.component()),e})(),m(nt,{}),m(Xe,{})]}})}const yt=Object.freeze(Object.defineProperty({__proto__:null,default:wt},Symbol.toStringTag,{value:"Module"})),Pt=[{configName:"onRenderClient",importPath:"/renderer/+onRenderClient.tsx",isValueFile:!0,exportValues:ce},{configName:"Page",importPath:"/pages/index/+Page.tsx",isValueFile:!0,exportValues:yt}],It={onBeforeRenderEnv:{definedAt:{isComputed:!0},valueSerialized:"null"}};export{Pt as configValuesImported,It as configValuesSerialized};
//# sourceMappingURL=pages_index.2qvs_0oJ.js.map
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}